import { FC } from 'react';
import { View, StyleSheet, TouchableOpacity, Platform } from 'react-native';
import { useNavigation } from '@react-navigation/native';
import { NativeStackNavigationProp } from '@react-navigation/native-stack';
import { RootStackParamList } from '../types/navigation';

// 웹에서 Safe Area 감지
const getSafeAreaTop = () => {
  if (Platform.OS === 'web') {
    // CSS env() 함수로 Safe Area 감지
    // @ts-ignore - 웹 환경 전용 코드
    const safeAreaTop = getComputedStyle(document.documentElement)
      .getPropertyValue('--safe-area-inset-top') || '44px';
    return parseInt(safeAreaTop.replace('px', '')) || 44;
  }
  return Platform.OS === 'ios' ? 44 : 20;
};

interface HeaderProps {
  hideOnOnboarding?: boolean;
  currentScreen?: string;
  onSettingsPress?: () => void;
}

type HeaderNavigationProp = NativeStackNavigationProp<RootStackParamList>;

const Header: FC<HeaderProps> = ({ hideOnOnboarding = false, currentScreen, onSettingsPress }) => {
  const navigation = useNavigation<HeaderNavigationProp>();
  
  // 온보딩 화면에서는 헤더를 숨김
  if (hideOnOnboarding) {
    return null;
  }
  return (
    <View style={styles.header}>
      <View style={styles.logoContainer}>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="55"
          height="16"
          viewBox="0 0 55 16"
          fill="none"
        >
          <path d="M41.7692 13.7649H35.4801V15.4855H41.7692V13.7649Z" fill="#B780FF"/>
          <path d="M0 0H6.06187C7.23323 0 8.23458 0.204688 9.06594 0.61516C9.89729 1.02454 10.5312 1.61124 10.9666 2.37307C11.4021 3.136 11.6203 4.0259 11.6203 5.04497C11.6203 6.06403 11.401 6.93532 10.9612 7.67965C10.5225 8.42397 9.87755 8.99425 9.02755 9.38939C8.17755 9.78454 7.16413 9.98266 5.98619 9.98266H1.88535V7.36331H5.48387C6.12658 7.36331 6.65522 7.27574 7.06871 7.1017C7.48219 6.92766 7.79368 6.66824 8.00097 6.32673C8.20826 5.98522 8.31135 5.55723 8.31135 5.04387C8.31135 4.53051 8.20826 4.07516 8.00097 3.71832C7.79368 3.36258 7.48 3.09331 7.05884 2.91161C6.63768 2.72991 6.10903 2.63906 5.474 2.63906H3.21355V15.4775H0V0ZM12.1786 15.4786H8.6009L4.84116 8.44476H8.32232L12.1786 15.4786Z" fill="#B780FF"/>
          <path d="M15.5774 14.793C14.7105 14.3066 14.0431 13.6138 13.5763 12.7123C13.1094 11.812 12.8749 10.7536 12.8749 9.53817C12.8749 8.32274 13.1083 7.28079 13.5763 6.36949C14.0431 5.45819 14.7018 4.75221 15.5511 4.25155C16.4004 3.75088 17.3846 3.50055 18.5046 3.50055C19.5534 3.50055 20.4882 3.72014 21.309 4.16042C22.1299 4.5996 22.7754 5.26276 23.2466 6.1499C23.7178 7.03595 23.9535 8.11962 23.9535 9.39874V10.2892H14.1713V8.30518H20.9671C20.9671 7.83306 20.8641 7.41364 20.657 7.04583C20.4498 6.67802 20.1649 6.39035 19.801 6.18284C19.4372 5.97533 19.0229 5.87212 18.5594 5.87212C18.0673 5.87212 17.6279 5.98521 17.2432 6.21029C16.8585 6.43537 16.556 6.74499 16.3391 7.13806C16.121 7.53112 16.0092 7.96042 16.0015 8.42485V10.2903C16.0015 10.8689 16.1122 11.3772 16.3336 11.8131C16.555 12.249 16.8673 12.5817 17.2695 12.8101C17.6728 13.0384 18.1418 13.1526 18.6766 13.1526C19.0328 13.1526 19.3583 13.101 19.6509 12.9967C19.9435 12.8935 20.1912 12.7574 20.395 12.5894C20.5989 12.4214 20.7534 12.2227 20.8608 11.9943H23.8789C23.7288 12.7025 23.4208 13.3217 22.9529 13.8542C22.486 14.3867 21.8822 14.7974 21.1446 15.0872C20.4071 15.3771 19.5698 15.522 18.635 15.522C17.4646 15.522 16.4465 15.2794 15.5796 14.793H15.5774Z" fill="#B780FF"/>
          <path d="M32.6877 15.4786H29.1273L25.0643 3.85004H28.4211L30.8484 12.2014H30.9765L33.4147 3.85004H36.7715L32.6877 15.4786Z" fill="#B780FF"/>
          <ellipse cx="48.4" cy="9.15357" rx="4.47857" ry="4.36072" fill="#B780FF"/>
          <path d="M48.4391 2.9357C51.7834 2.9357 54.4995 5.66373 54.4997 9.03531C54.4997 12.4071 51.7836 15.1359 48.4391 15.1359C45.0948 15.1358 42.3786 12.407 42.3786 9.03531C42.3788 5.66379 45.0949 2.93579 48.4391 2.9357Z" stroke="#B780FF"/>
        </svg>
      </View>
      <View style={styles.headerIcons}>
        <TouchableOpacity style={styles.headerIcon}>
          <svg width="24" height="28" viewBox="0 0 26 30" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 27.5858C10.0615 28.4653 11.4633 29 13 29C14.5367 29 15.9385 28.4653 17 27.5858M1.76145 23.0606C1.12903 23.0606 0.77581 22.0303 1.15836 21.4578C2.04604 20.1295 2.90283 18.1813 2.90283 15.8353L2.93944 12.4359C2.93944 6.12004 7.44371 1 13 1C18.6381 1 23.2088 6.19545 23.2088 12.6044L23.1721 15.8353C23.1721 18.1975 23.9994 20.1563 24.851 21.4851C25.2187 22.059 24.8646 23.0606 24.24 23.0606H1.76145Z" stroke="#F5F5F5" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
          </svg>
        </TouchableOpacity>
        <TouchableOpacity 
          style={styles.headerIcon}
          onPress={onSettingsPress || (() => navigation.navigate('Settings'))}
        >
          <svg width="28" height="28" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10.8478 4.76923L11.8565 2.37846C12.0267 1.97368 12.326 1.6255 12.7152 1.37953C13.1045 1.13357 13.5656 1.00128 14.0382 1H15.9618C16.4344 1.00128 16.8955 1.13357 17.2848 1.37953C17.674 1.6255 17.9733 1.97368 18.1435 2.37846L19.1522 4.76923L22.5772 6.57846L25.3453 6.19077C25.8062 6.13333 26.2753 6.20299 26.693 6.39091C27.1107 6.57883 27.4582 6.87652 27.6912 7.24615L28.6295 8.75385C28.8699 9.12937 28.9807 9.563 28.9472 9.99752C28.9137 10.432 28.7375 10.847 28.4418 11.1877L26.7293 13.1908V16.8092L28.4887 18.8123C28.7844 19.153 28.9606 19.568 28.9941 20.0025C29.0276 20.437 28.9169 20.8706 28.6764 21.2462L27.7381 22.7538C27.5051 23.1235 27.1576 23.4212 26.7399 23.6091C26.3222 23.797 25.8531 23.8667 25.3922 23.8092L22.6241 23.4215L19.1991 25.2308L18.1904 27.6215C18.0203 28.0263 17.721 28.3745 17.3317 28.6205C16.9424 28.8664 16.4813 28.9987 16.0087 29H14.0382C13.5656 28.9987 13.1045 28.8664 12.7152 28.6205C12.326 28.3745 12.0267 28.0263 11.8565 27.6215L10.8478 25.2308L7.42284 23.4215L4.65472 23.8092C4.19379 23.8667 3.72467 23.797 3.30697 23.6091C2.88927 23.4212 2.54185 23.1235 2.30885 22.7538L1.3705 21.2462C1.13005 20.8706 1.01927 20.437 1.05278 20.0025C1.08628 19.568 1.2625 19.153 1.55817 18.8123L3.27065 16.8092V13.1908L1.51125 11.1877C1.21558 10.847 1.03936 10.432 1.00586 9.99752C0.972353 9.563 1.08314 9.12937 1.32358 8.75385L2.26193 7.24615C2.49493 6.87652 2.84236 6.57883 3.26006 6.39091C3.67776 6.20299 4.14688 6.13333 4.6078 6.19077L7.37593 6.57846L10.8478 4.76923ZM10.3083 15C10.3083 15.852 10.5834 16.6848 11.099 17.3932C11.6145 18.1016 12.3472 18.6537 13.2045 18.9798C14.0619 19.3058 15.0052 19.3911 15.9153 19.2249C16.8254 19.0587 17.6614 18.6484 18.3176 18.046C18.9737 17.4436 19.4206 16.676 19.6016 15.8404C19.7826 15.0048 19.6897 14.1386 19.3346 13.3515C18.9795 12.5644 18.3781 11.8916 17.6066 11.4183C16.835 10.9449 15.9279 10.6923 15 10.6923C13.7557 10.6923 12.5623 11.1462 11.6824 11.954C10.8026 12.7618 10.3083 13.8575 10.3083 15Z" stroke={currentScreen === 'Settings' ? '#B780FF' : '#F5F5F5'} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
          </svg>
        </TouchableOpacity>
      </View>
    </View>
  );
};

const styles = StyleSheet.create({
  header: {
    position: 'absolute',
    left: 16,
    top: 0,
    right: 16,
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    paddingTop: getSafeAreaTop(), // Safe Area 자동 감지
    zIndex: 1000,
  },
  logoContainer: {
    width: 55,
    height: 15.636,
    flexShrink: 0,
    justifyContent: 'center',
    alignItems: 'center',
  },
  headerIcons: {
    flexDirection: 'row',
    gap: 12,
  },
  headerIcon: {
    width: 28,
    height: 28,
    justifyContent: 'center',
    alignItems: 'center',
  },
});

export default Header;
